<img src="../images/ailrlines/airline-1.jpg" alt="" srcset="">

// import info from '../hope.json' assert {type: 'json'};

// api url
const api_url =  "https://taher2552.github.io/flight_data.json/Flight_json";
// Defining async function
async function fetchData(url) {
    // Storing response
    const response = await fetch(url);
    // Storing data in form of JSON
    const data = await response.json();
    return data;
    console.log(data);
    // console.log(data)
}
//whenever we need the data from api we are sending request and then using the same data in our functions
// async function showData(){
//   let data = await fetchData(api_url);
//   console.log(data);
// }
// showData();
// fetch('https://jsonplaceholder.typicode.com/todos/1')
//       .then(response => response.json())
//       .then(json => console.log(json))




const flightInfoDisplay = document.querySelector('.flight_info_display');
const arriveCityContainer = document.querySelector('.arrive_city_container');
const departCityContainer = document.querySelector('.depart_city_container');
const tripArrive = document.querySelector('.trip_arrive');
const tripDepart =document.querySelector('.trip_depart');
const arriveCityDisplay = document.querySelector('.arrive_city_display');
const departCityDisplay = document.querySelector('.depart_city_display');
const departCity = document.getElementById("depart_city");
const arriveCity =document.getElementById("arrive_city");

const searchButton = document.querySelector('.search_btn');

let bookingArray=JSON.parse(localStorage.getItem("booking")) ?? [];







let arriveCityValue;
let departCityValue;

searchFunction();


function cityText(){
   let selectArriveCity = arriveCity.selectedIndex;
   arriveCityValue = document.getElementsByClassName("arrive_option")[selectArriveCity].value;
   arriveCityDisplay.innerText = arriveCityValue;
}

function departCityText(){
   let selectDepartCity = departCity.selectedIndex;
   departCityValue = document.getElementsByClassName("depart_option")[selectDepartCity].value;
   departCityDisplay.innerText = departCityValue;
}


function displaySearchResult(val){

   let dynamicImageName ={
      
      "air india": 1,
      "akasa": 2,
      "emirates": 3,
      "indigo" : 4,
      "spice jet":5,
      "vistara":6
   }

   let image_number=dynamicImageName[val.flight];

   flightInfoDisplay.innerHTML+=`
   <div class="wrapper_search">
   <div class="blue_lock_box">
   <img src=../images/ailrlines/airline-${image_number}.jpg" alt="" srcset="">
   <p>Lock this Price<span>i</span></p>
</div>

<div class="go_first">
   <div class="go_first_logo">
      <img src="https://imgak.mmtcdn.com/flights/assets/media/dt/common/icons/G8.png?v=14" )" alt=""
         srcset="">
      <div class="go_first_para">
         <p class="flight_name">${val.flight} </p>
         <p>G8 713, G8 392</p>
      </div>
   </div>
   <div class="flight_time">
      <p class="departure_time">${val.dept_time}</p>
      <p class="departure_airport hidden">${val.depart_airport_name}</p>
      <p class="arrival_airport hidden">${val.arrive_airport_name}</p>
      <p class="departure_city_name">${val.depart_city_name}</p>
   </div>
   <div class="one_stop">
      <p class="total_duration">${val.total_duration}</p>
      <div class="blue_line"></div>
      <p>Non Stop</p>
   </div>

   <div class>
      <div class="arrival_info">
         <p class="arrival_time">${val.arrive_time}</p>
         <div class="plus_one_day">
            <p>+1</p>
            <p>Day</p>
         </div>
      </div>
      <p class="destination arrival_city_name">${val.arrive_city_name}</p>
   </div>
   <div class="price_details">
      <p class="ticket_price">â‚¹ ${val.price}</p>
   </div>

    <button class="info_btn">Book Now <i class="fa fa-angle-down" aria-hidden="true"></i></button>
</div>
</div>
   `

  
}







async function searchFunction(){

   cityText();
   departCityText();

   flightInfoDisplay.innerHTML="";

   let data = await fetchData(api_url);

data.data.map((val)=>{

   
   if(val.depart_city_name==departCityValue && val.arrive_city_name==arriveCityValue){
      displaySearchResult(val);
   }
})

   
}

function departCityClick(){
   departCity.classList.remove('hidden');
}
function arriveCityClick(){
   arriveCity.classList.remove('hidden');
}

function disappearDepartSelectMenu(){
   departCityText();
   departCity.classList.add('hidden');
}
function disappearArriveSelectMenu(){
   cityText();
   arriveCity.classList.add('hidden');
}

function bookingTicket(e){
   if(e.target.classList.contains('info_btn')){
      let flightNamePath = e.path[1].firstElementChild;
      let flightDetailPath = flightNamePath.nextElementSibling.nextElementSibling;
      let airportDetails = flightNamePath.nextElementSibling.firstElementChild;
     
    const bookingTicketObj = {
     flight : flightNamePath.querySelector('p').innerText,
     departure_time : flightNamePath.nextElementSibling.firstElementChild.innerText,
     departure_city : flightNamePath.nextElementSibling.lastElementChild.innerText,
     flight_duration : flightDetailPath.querySelector('p').innerText,
     ticket_price : e.path[1].lastElementChild.previousElementSibling.querySelector('p').innerText,
     arrival_time : flightDetailPath.nextElementSibling.firstElementChild.querySelector('p').innerText,
     arrival_city : flightDetailPath.nextElementSibling.lastElementChild.innerText,
     departure_airport : airportDetails.nextElementSibling.innerText,
     arrival_airport : airportDetails.nextElementSibling.nextElementSibling.innerText 
     
   }


 bookingArray.push(bookingTicketObj)

localStorage.setItem("booking", JSON.stringify(bookingArray));  

window.location.href = "../html/booking.html";
   }
 
}


searchButton.addEventListener('click', searchFunction);

tripDepart.addEventListener('click', departCityClick);

tripDepart.addEventListener('change', disappearDepartSelectMenu);

tripArrive.addEventListener('click', arriveCityClick);

tripArrive.addEventListener('change', disappearArriveSelectMenu);

flightInfoDisplay.addEventListener('click', bookingTicket);






